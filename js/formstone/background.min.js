!function(e,t){"use strict";function i(){k.iterate.call(H,v)}function n(){H=e($.base)}function a(t){t.youTubeGuid=0,t.$container=e('<div class="'+x.container+'"></div>').appendTo(this),this.addClass([x.base,t.customClass].join(" "));var i=t.source;t.source=null,r(t,i,!0),n()}function o(e){e.$container.remove(),this.removeClass([x.base,e.customClass].join(" ")).off(C.namespace),n()}function r(t,i,n){if(i!==t.source){if(t.source=i,t.responsive=!1,t.isYouTube=!1,"object"===e.type(i)&&"string"===e.type(i.video)){var a=i.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);a&&a.length>=1&&(t.isYouTube=!0,t.videoId=a[1])}var o=!t.isYouTube&&"object"===e.type(i)&&(i.hasOwnProperty("mp4")||i.hasOwnProperty("ogg")||i.hasOwnProperty("webm"));if(t.video=t.isYouTube||o,t.playing=!1,t.isYouTube)t.playerReady=!1,t.posterLoaded=!1,d(t,i,n);else if("object"===e.type(i)&&i.hasOwnProperty("poster"))c(t,i,n);else{var r=i;if("object"===e.type(i)){var u,p=[],f=[];for(u in i)i.hasOwnProperty(u)&&f.push(u);f.sort(k.sortAsc);for(u in f)f.hasOwnProperty(u)&&p.push({width:parseInt(f[u]),url:i[f[u]],mq:window.matchMedia("(min-width: "+parseInt(f[u])+"px)")});t.responsive=!0,t.sources=p,r=s(t)}l(t,r,!1,n)}}else t.$el.trigger(C.loaded)}function s(e){var i=e.source;if(e.responsive){i=e.sources[0].url;for(var n in e.sources)e.sources.hasOwnProperty(n)&&(t.support.nativeMatchMedia?e.sources[n].mq.matches&&(i=e.sources[n].url):e.sources[n].width<t.fallbackWidth&&(i=e.sources[n].url))}return i}function l(t,i,n,a){var o=[x.media,x.image,a!==!0?x.animated:""].join(" "),r=e('<div class="'+o+'"><img></div>'),s=r.find("img"),l=i;s.one(C.load,function(){E&&r.addClass(x["native"]).css({backgroundImage:"url('"+l+"')"}),r.fsTransition({property:"opacity"},function(){n||u(t)}).css({opacity:1}),b(t),(!n||a)&&t.$el.trigger(C.loaded)}).attr("src",l),t.responsive&&r.addClass(x.responsive),t.$container.append(r),(s[0].complete||4===s[0].readyState)&&s.trigger(C.load),t.currentSource=l}function c(i,n,a){if(i.source&&i.source.poster&&(l(i,i.source.poster,!0,!0),a=!1),!t.isMobile){var o=[x.media,x.video,a!==!0?x.animated:""].join(" "),r='<div class="'+o+'">';r+="<video",i.loop&&(r+=" loop"),i.mute&&(r+=" muted"),r+=">",i.source.webm&&(r+='<source src="'+i.source.webm+'" type="video/webm" />'),i.source.mp4&&(r+='<source src="'+i.source.mp4+'" type="video/mp4" />'),i.source.ogg&&(r+='<source src="'+i.source.ogg+'" type="video/ogg" />'),r+="</video>",r+="</div>";var s=e(r),c=s.find("video");c.one(C.loadedMetaData,function(){s.fsTransition({property:"opacity"},function(){u(i)}).css({opacity:1}),b(i),i.$el.trigger(C.loaded),i.autoPlay&&h(i)}),i.$container.append(s)}}function d(i,n,a){if(!i.videoId){var o=n.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);i.videoId=o[1]}if(i.posterLoaded||(i.source.poster||(i.source.poster="http://img.youtube.com/vi/"+i.videoId+"/0.jpg"),i.posterLoaded=!0,l(i,i.source.poster,!0,a),a=!1),!t.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"></script>'),W){var r=i.guid+"_"+i.youTubeGuid++,s=[x.media,x.embed,a!==!0?x.animated:""].join(" "),c='<div class="'+s+'">';c+='<div id="'+r+'"></div>',c+="</div>";var d=e(c),p=e.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:r,loop:i.loop?1:0,autoplay:1,origin:T.location.protocol+"//"+T.location.host},i.youtubeOptions);i.$container.append(d),i.player&&(i.oldPlayer=i.player,i.player=null),i.player=new T.YT.Player(r,{videoId:i.videoId,playerVars:p,events:{onReady:function(){i.playerReady=!0,i.mute&&i.player.mute(),i.autoPlay&&i.player.playVideo()},onStateChange:function(e){i.playing||e.data!==T.YT.PlayerState.PLAYING?i.loop&&i.playing&&e.data===T.YT.PlayerState.ENDED&&i.player.playVideo():(i.playing=!0,i.autoPlay||i.player.pauseVideo(),d.fsTransition({property:"opacity"},function(){u(i)}).css({opacity:1}),b(i),i.$el.trigger(C.loaded)),i.$el.find($.embed).addClass(x.ready)},onPlaybackQualityChange:function(){},onPlaybackRateChange:function(){},onError:function(){},onApiChange:function(){}}}),b(i)}else M.push({data:i,source:n})}function u(e){var t=e.$container.find($.media);t.length>=1&&(t.not(":last").remove(),e.oldPlayer=null)}function p(e){var t=e.$container.find($.media);t.length>=1&&t.fsTransition({property:"opacity"},function(){t.remove(),delete e.source}).css({opacity:0})}function f(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var t=e.$container.find("video");t.length&&t[0].pause()}e.playing=!1}}function h(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var t=e.$container.find("video");t.length&&t[0].play()}e.playing=!0}}function g(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.mute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!0)}e.playing=!0}}function m(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.unMute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!1)}e.playing=!0}}function v(e){if(e.responsive){var t=s(e);t!==e.currentSource?l(e,t,!1,!0):b(e)}else b(e)}function b(e){for(var t=e.$container.find($.media),i=0,n=t.length;n>i;i++){var a=t.eq(i),o=e.isYouTube?"iframe":a.find("video").length?"video":"img",r=a.find(o);if(r.length&&("img"!==o||!E)){var s=e.$el.outerWidth(),l=e.$el.outerHeight(),c=y(e,r);e.width=c.width,e.height=c.height,e.left=0,e.top=0;var d=e.isYouTube?e.embedRatio:e.width/e.height;e.height=l,e.width=e.height*d,e.width<s&&(e.width=s,e.height=e.width/d),e.left=-(e.width-s)/2,e.top=-(e.height-l)/2,a.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function y(t,i){if(t.isYouTube)return{height:500,width:500/t.embedRatio};if(i.is("img")){var n=i[0];if("undefined"!==e.type(n.naturalHeight))return{height:n.naturalHeight,width:n.naturalWidth};var a=new Image;return a.src=n.src,{height:a.height,width:a.width}}return{height:i[0].videoHeight,width:i[0].videoWidth}}var w=t.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:a,_destruct:o,_resize:i,play:h,pause:f,mute:g,unmute:m,resize:b,load:r,unload:p}}),$=w.classes,x=$.raw,C=w.events,k=w.functions,T=t.window,H=[],E="backgroundSize"in t.document.documentElement.style,W=!1,M=[];T.onYouTubeIframeAPIReady=function(){W=!0;for(var e in M)M.hasOwnProperty(e)&&d(M[e].data,M[e].source);M=[]}}(jQuery,Formstone);
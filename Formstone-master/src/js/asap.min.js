!function(e,t,n){"use strict";function i(n){!W&&t.support.history&&(w=t.$body,W=e.extend(v,n),W.render===e.noop&&(W.render=d),W.transitionOut===e.noop&&(W.transitionOut=function(){return e.Deferred().resolve()}),history.state?(E=history.state.id,T=history.state.url):(T=window.location.href,h(E,T)),b.on(x.popState,s),o())}function o(){w&&!w.hasClass(C.base)&&w.on(x.click,v.selector,r).addClass(C.base)}function r(e){var t=e.currentTarget;e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||window.location.protocol!==t.protocol||window.location.host!==t.host||"_blank"===t.target||(!t.hash||t.href.replace(t.hash,"")!==window.location.href.replace(location.hash,"")&&t.href!==window.location.href+"#")&&($.killEvent(e),e.stopImmediatePropagation(),t.href!==T&&l(t.href,!0))}function s(e){H&&H.abort();var t=e.originalEvent.state;E=t.id,t.url!==T&&l(t.url,!1)}function l(t,n){H&&H.abort(),b.trigger(x.requested,[!1]),W.transitionOutDeferred=W.transitionOut.apply(y,[!1]);var i=g(t),a=i.params,o=i.hash,r=i.clean,s="User error",l=null,d=e.Deferred();a[W.requestKey]=!0,H=e.ajax({url:r,data:a,dataType:"json",cache:W.cache,xhr:function(){var e=new y.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;b.trigger(x.progress,[t])}},!1),e},success:function(n,a,r){l="string"===e.type(n)?e.parseJSON(n):n,n.location&&(t=n.location,i=g(t),o=i.hash),d.resolve()},error:function(e,t,n){s=n,d.reject()}}),e.when(d,W.transitionOutDeferred).done(function(){c(i,l,n)}).fail(function(){b.trigger(x.failed,[s])})}function c(t,i,a){b.trigger(x.loaded,[i]),e.fsAnalytics!==n&&e.fsAnalytics("pageview"),W.render.call(this,i,t.hash),T=t.url,a&&(E++,f(E,T)),b.trigger(x.rendered,[i]);var o=!1;if(""!==t.hash){var r=e(t.hash);r.length&&(o=r.offset().top)}o!==!1&&b.scrollTop(o)}function d(t,n){if("undefined"!==e.type(t)){var i;for(var a in t)t.hasOwnProperty(a)&&(i=e(a),i.length&&i.html(t[a]))}}function u(e){W&&t.support.history?e&&l(e,!0):window.location.href=e}function p(e){var t=history.state;T=e,h(t.id,e)}function f(e,t){history.pushState({id:e,url:t},k+e,t)}function h(e,t){history.replaceState({id:e,url:t},k+e,t)}function g(e){var t=e.indexOf("?"),n=e.indexOf("#"),i={},a="",o=e;return n>-1&&(a=e.slice(n),o=e.slice(0,n)),t>-1&&(i=$.parseQueryString(e.slice(t+1,n>-1?n:e.length)),o=e.slice(0,t)),{hash:a,params:i,url:e,clean:o}}var w,H,W,m=t.Plugin("asap",{utilities:{_initialize:i,load:u,replace:p},events:{failed:"failed",loaded:"loaded",popState:"popstate",progress:"progress",requested:"requested",rendered:"rendered"}}),v={cache:!0,selector:"a",render:e.noop,requestKey:"fs-asap",transitionOut:e.noop},b=t.$window,y=b[0],$=m.functions,x=m.events,C=m.classes.raw,k="asap-",T="",E=1}(jQuery,Formstone);
!function(e,t){"use strict";function n(){T.iterate.call(E,v)}function i(){E=e(x.base)}function o(t){t.youTubeGuid=0,t.$container=e('<div class="'+$.container+'"></div>').appendTo(this),this.addClass([$.base,t.customClass].join(" "));var n=t.source;t.source=null,r(t,n,!0),i()}function a(e){e.$container.remove(),this.removeClass([$.base,e.customClass].join(" ")).off(C.namespace),i()}function r(t,n,i){if(n!==t.source){if(t.source=n,t.responsive=!1,t.isYouTube=!1,"object"===e.type(n)&&"string"===e.type(n.video)){var o=n.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);o&&o.length>=1&&(t.isYouTube=!0,t.videoId=o[1])}var a=!t.isYouTube&&"object"===e.type(n)&&(n.hasOwnProperty("mp4")||n.hasOwnProperty("ogg")||n.hasOwnProperty("webm"));if(t.video=t.isYouTube||a,t.playing=!1,t.isYouTube)t.playerReady=!1,t.posterLoaded=!1,d(t,n,i);else if("object"===e.type(n)&&n.hasOwnProperty("poster"))c(t,n,i);else{var r=n;if("object"===e.type(n)){var u,p=[],f=[];for(u in n)n.hasOwnProperty(u)&&f.push(u);f.sort(T.sortAsc);for(u in f)f.hasOwnProperty(u)&&p.push({width:parseInt(f[u]),url:n[f[u]],mq:window.matchMedia("(min-width: "+parseInt(f[u])+"px)")});t.responsive=!0,t.sources=p,r=s(t)}l(t,r,!1,i)}}else t.$el.trigger(C.loaded)}function s(e){var n=e.source;if(e.responsive){n=e.sources[0].url;for(var i in e.sources)e.sources.hasOwnProperty(i)&&(t.support.nativeMatchMedia?e.sources[i].mq.matches&&(n=e.sources[i].url):e.sources[i].width<t.fallbackWidth&&(n=e.sources[i].url))}return n}function l(t,n,i,o){var a=[$.media,$.image,o!==!0?$.animated:""].join(" "),r=e('<div class="'+a+'"><img></div>'),s=r.find("img"),l=n;s.one(C.load,function(){S&&r.addClass($["native"]).css({backgroundImage:"url('"+l+"')"}),r.fsTransition({property:"opacity"},function(){i||u(t)}).css({opacity:1}),y(t),(!i||o)&&t.$el.trigger(C.loaded)}).attr("src",l),t.responsive&&r.addClass($.responsive),t.$container.append(r),(s[0].complete||4===s[0].readyState)&&s.trigger(C.load),t.currentSource=l}function c(n,i,o){if(n.source&&n.source.poster&&(l(n,n.source.poster,!0,!0),o=!1),!t.isMobile){var a=[$.media,$.video,o!==!0?$.animated:""].join(" "),r='<div class="'+a+'">';r+="<video",n.loop&&(r+=" loop"),n.mute&&(r+=" muted"),r+=">",n.source.webm&&(r+='<source src="'+n.source.webm+'" type="video/webm" />'),n.source.mp4&&(r+='<source src="'+n.source.mp4+'" type="video/mp4" />'),n.source.ogg&&(r+='<source src="'+n.source.ogg+'" type="video/ogg" />'),r+="</video>",r+="</div>";var s=e(r),c=s.find("video");c.one(C.loadedMetaData,function(){s.fsTransition({property:"opacity"},function(){u(n)}).css({opacity:1}),y(n),n.$el.trigger(C.loaded),n.autoPlay&&h(n)}),n.$container.append(s)}}function d(n,i,o){if(!n.videoId){var a=i.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);n.videoId=a[1]}if(n.posterLoaded||(n.source.poster||(n.source.poster="http://img.youtube.com/vi/"+n.videoId+"/0.jpg"),n.posterLoaded=!0,l(n,n.source.poster,!0,o),o=!1),!t.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"></script>'),j){var r=n.guid+"_"+n.youTubeGuid++,s=[$.media,$.embed,o!==!0?$.animated:""].join(" "),c='<div class="'+s+'">';c+='<div id="'+r+'"></div>',c+="</div>";var d=e(c),p=e.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:r,loop:n.loop?1:0,autoplay:1,origin:k.location.protocol+"//"+k.location.host},n.youtubeOptions);n.$container.append(d),n.player&&(n.oldPlayer=n.player,n.player=null),n.player=new k.YT.Player(r,{videoId:n.videoId,playerVars:p,events:{onReady:function(){n.playerReady=!0,n.mute&&n.player.mute(),n.autoPlay&&n.player.playVideo()},onStateChange:function(e){n.playing||e.data!==k.YT.PlayerState.PLAYING?n.loop&&n.playing&&e.data===k.YT.PlayerState.ENDED&&n.player.playVideo():(n.playing=!0,n.autoPlay||n.player.pauseVideo(),d.fsTransition({property:"opacity"},function(){u(n)}).css({opacity:1}),y(n),n.$el.trigger(C.loaded)),n.$el.find(x.embed).addClass($.ready)},onPlaybackQualityChange:function(){},onPlaybackRateChange:function(){},onError:function(){},onApiChange:function(){}}}),y(n)}else H.push({data:n,source:i})}function u(e){var t=e.$container.find(x.media);t.length>=1&&(t.not(":last").remove(),e.oldPlayer=null)}function p(e){var t=e.$container.find(x.media);t.length>=1&&t.fsTransition({property:"opacity"},function(){t.remove(),delete e.source}).css({opacity:0})}function f(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var t=e.$container.find("video");t.length&&t[0].pause()}e.playing=!1}}function h(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var t=e.$container.find("video");t.length&&t[0].play()}e.playing=!0}}function g(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.mute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!0)}e.playing=!0}}function m(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.unMute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!1)}e.playing=!0}}function v(e){if(e.responsive){var t=s(e);t!==e.currentSource?l(e,t,!1,!0):y(e)}else y(e)}function y(e){for(var t=e.$container.find(x.media),n=0,i=t.length;i>n;n++){var o=t.eq(n),a=e.isYouTube?"iframe":o.find("video").length?"video":"img",r=o.find(a);if(r.length&&("img"!==a||!S)){var s=e.$el.outerWidth(),l=e.$el.outerHeight(),c=b(e,r);e.width=c.width,e.height=c.height,e.left=0,e.top=0;var d=e.isYouTube?e.embedRatio:e.width/e.height;e.height=l,e.width=e.height*d,e.width<s&&(e.width=s,e.height=e.width/d),e.left=-(e.width-s)/2,e.top=-(e.height-l)/2,o.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function b(t,n){if(t.isYouTube)return{height:500,width:500/t.embedRatio};if(n.is("img")){var i=n[0];if("undefined"!==e.type(i.naturalHeight))return{height:i.naturalHeight,width:i.naturalWidth};var o=new Image;return o.src=i.src,{height:o.height,width:o.width}}return{height:n[0].videoHeight,width:n[0].videoWidth}}var w=t.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:o,_destruct:a,_resize:n,play:h,pause:f,mute:g,unmute:m,resize:y,load:r,unload:p}}),x=w.classes,$=x.raw,C=w.events,T=w.functions,k=t.window,E=[],S="backgroundSize"in t.document.documentElement.style,j=!1,H=[];k.onYouTubeIframeAPIReady=function(){j=!0;for(var e in H)H.hasOwnProperty(e)&&d(H[e].data,H[e].source);H=[]}}(jQuery,Formstone);
!function(e,t){"use strict";function n(e){e.touches=[],e.touching=!1,this.on(v.dragStart,b.killEvent),e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on(v.touchStart,e,o).on(v.click,e,d),t.support.touch&&t.support.pointer&&this.on(v.pointerDown,e,o)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):f(this,"none"),this.on(v.touchStart,e,a).on(v.mouseDown,e,o),t.support.touch&&t.support.pointer&&this.on(v.pointerDown,e,a))}function i(){this.off(v.namespace),f(this,"")}function a(e){e.preventManipulation&&e.preventManipulation();var t=e.data,n=e.originalEvent;if(n.type.match(/(up|end|cancel)$/i))return void c(e);if(n.pointerId){var i=!1;for(var a in t.touches)t.touches[a].id===n.pointerId&&(i=!0,t.touches[a].pageX=n.clientX,t.touches[a].pageY=n.clientY);i||t.touches.push({id:n.pointerId,pageX:n.clientX,pageY:n.clientY})}else t.touches=n.touches;n.type.match(/(down|start)$/i)?o(e):n.type.match(/move$/i)&&r(e)}function o(t){var n=t.data,i="undefined"!==e.type(n.touches)?n.touches[0]:null;if(n.touching||(n.startE=t.originalEvent,n.startX=i?i.pageX:t.pageX,n.startY=i?i.pageY:t.pageY,n.startT=(new Date).getTime(),n.scaleD=1,n.passed=!1),n.tap)n.clicked=!1,n.$el.on([v.touchMove,v.pointerMove].join(" "),n,a).on([v.touchEnd,v.touchCancel,v.pointerUp,v.pointerCancel].join(" "),n,a);else if(n.pan||n.scale){n.$links&&n.$links.off(v.click);var o=u(n.scale?v.scaleStart:v.panStart,t,n.startX,n.startY,n.scaleD,0,0,"","");if(n.scale&&n.touches&&n.touches.length>=2){var s=n.touches;n.pinch={startX:p(s[0].pageX,s[1].pageX),startY:p(s[0].pageY,s[1].pageY),startD:h(s[1].pageX-s[0].pageX,s[1].pageY-s[0].pageY)},o.pageX=n.startX=n.pinch.startX,o.pageY=n.startY=n.pinch.startY}n.touching||(n.touching=!0,n.pan&&y.on(v.mouseMove,n,r).on(v.mouseUp,n,c),y.on([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel].join(" "),n,a),n.$el.trigger(o))}}function r(t){var n=t.data,i="undefined"!==e.type(n.touches)?n.touches[0]:null,a=i?i.pageX:t.pageX,o=i?i.pageY:t.pageY,r=a-n.startX,s=o-n.startY,l=r>0?"right":"left",d=s>0?"down":"up",f=Math.abs(r)>w,g=Math.abs(s)>w;if(n.tap)(f||g)&&n.$el.off([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel].join(" "));else if(n.pan||n.scale)if(!n.passed&&n.axis&&(n.axisX&&g||n.axisY&&f))c(t);else{!n.passed&&(!n.axis||n.axis&&n.axisX&&f||n.axisY&&g)&&(n.passed=!0),n.passed&&(b.killEvent(t),b.killEvent(n.startE));var m=!0,y=u(n.scale?v.scale:v.pan,t,a,o,n.scaleD,r,s,l,d);if(n.scale)if(n.touches&&n.touches.length>=2){var $=n.touches;n.pinch.endX=p($[0].pageX,$[1].pageX),n.pinch.endY=p($[0].pageY,$[1].pageY),n.pinch.endD=h($[1].pageX-$[0].pageX,$[1].pageY-$[0].pageY),n.scaleD=n.pinch.endD/n.pinch.startD,y.pageX=n.pinch.endX,y.pageY=n.pinch.endY,y.scale=n.scaleD,y.deltaX=n.pinch.endX-n.pinch.startX,y.deltaY=n.pinch.endY-n.pinch.startY}else n.pan||(m=!1);m&&n.$el.trigger(y)}}function s(t,n){t.on(v.click,n,l);var i=e._data(t[0],"events").click;i.unshift(i.pop())}function l(e){b.killEvent(e,!0),e.data.$links.off(v.click)}function c(t){var n=t.data;if(n.tap)n.$el.off([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel,v.mouseMove,v.mouseUp].join(" ")),n.startE.preventDefault(),d(t);else if(n.pan||n.scale){var i="undefined"!==e.type(n.touches)?n.touches[0]:null,a=i?i.pageX:t.pageX,o=i?i.pageY:t.pageY,r=a-n.startX,l=o-n.startY,c=(new Date).getTime(),p=n.scale?v.scaleEnd:v.panEnd,h=r>0?"right":"left",f=l>0?"down":"up",g=Math.abs(r)>1,m=Math.abs(l)>1;if(n.swipe&&Math.abs(r)>w&&c-n.startT<$&&(p=v.swipe),n.axis&&(n.axisX&&m||n.axisY&&g)||g||m){n.$links=n.$el.find("a");for(var b=0,x=n.$links.length;x>b;b++)s(n.$links.eq(b),n)}var C=u(p,t,a,o,n.scaleD,r,l,h,f);y.off([v.touchMove,v.touchEnd,v.touchCancel,v.mouseMove,v.mouseUp,v.pointerMove,v.pointerUp,v.pointerCancel].join(" ")),n.$el.trigger(C),n.touches=[],n.scale}n.touching=!1}function d(e){b.killEvent(e);var t=e.data,n=e.type;if("click"===n||!t.clicked){"click"!==n&&(t.clicked=!0);var i=t.startE?t.startX:e.pageX,a=t.startE?t.startY:e.pageY,o=u(v.tap,e.originalEvent,i,a,1,0,0);t.$el.trigger(o)}}function u(t,n,i,a,o,r,s,l,c){return e.Event(t,{originalEvent:n,bubbles:!0,pageX:i,pageY:a,scale:o,deltaX:r,deltaY:s,directionX:l,directionY:c})}function p(e,t){return(e+t)/2}function h(e,t){return Math.sqrt(e*e+t*t)}function f(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var g=!t.window.PointerEvent,m=t.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:n,_destruct:i},events:{pointerDown:g?"MSPointerDown":"pointerdown",pointerUp:g?"MSPointerUp":"pointerup",pointerMove:g?"MSPointerMove":"pointermove",pointerCancel:g?"MSPointerCancel":"pointercancel"}}),v=m.events,b=m.functions,y=t.$window,w=10,$=50;v.tap="tap",v.pan="pan",v.panStart="panstart",v.panEnd="panend",v.scale="scale",v.scaleStart="scalestart",v.scaleEnd="scaleend",v.swipe="swipe"}(jQuery,Formstone);
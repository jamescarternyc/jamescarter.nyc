!function(e,t){"use strict";function n(e){if(t.support.file){var n="";n+='<div class="'+y.target+'">',n+=e.label,n+="</div>",n+='<input class="'+y.input+'" type="file"',e.multiple&&(n+=" multiple"),n+=">",this.addClass(y.base).append(n),e.$input=this.find(b.input),e.queue=[],e.total=0,e.uploading=!1,e.disabled=!0,e.aborting=!1,this.on(w.click,b.target,e,l).on(w.dragEnter,e,d).on(w.dragOver,e,u).on(w.dragLeave,e,p).on(w.drop,b.target,e,h),e.$input.on(w.change,e,c),s.call(this,e)}}function i(e){t.support.file&&(e.$input.off(w.namespace),this.off([w.click,w.dragEnter,w.dragOver,w.dragLeave,w.drop].join(" ")).removeClass(y.base).html(""))}function a(t,n){var i;t.aborting=!0;for(var a in t.queue)t.queue.hasOwnProperty(a)&&(i=t.queue[a],("undefined"===e.type(n)||n>=0&&i.index===n)&&(i.started&&!i.complete?i.transfer.abort():o(t,i,"abort")));t.aborting=!1,g(t)}function o(e,t,n){t.error=!0,e.$el.trigger(w.fileError,[t,n]),e.aborting||g(e)}function r(e){e.disabled||(this.addClass(y.disabled),e.$input.prop("disabled",!0),e.disabled=!0)}function s(e){e.disabled&&(this.removeClass(y.disabled),e.$input.prop("disabled",!1),e.disabled=!1)}function l(e){$.killEvent(e);var t=e.data;t.disabled||t.$input.trigger(w.click)}function c(e){$.killEvent(e);var t=e.data,n=t.$input[0].files;!t.disabled&&n.length&&f(t,n)}function d(e){$.killEvent(e);var t=e.data;t.$el.addClass(y.dropping)}function u(e){$.killEvent(e);var t=e.data;t.$el.addClass(y.dropping)}function p(e){$.killEvent(e);var t=e.data;t.$el.removeClass(y.dropping)}function h(e){$.killEvent(e);var t=e.data,n=e.originalEvent.dataTransfer.files;t.$el.removeClass(y.dropping),t.disabled||f(t,n)}function f(e,t){for(var n=[],i=0;i<t.length;i++){var a={index:e.total++,file:t[i],name:t[i].name,size:t[i].size,started:!1,complete:!1,error:!1,transfer:null};n.push(a),e.queue.push(a)}e.uploading||(C.on(w.beforeUnload,function(){return e.leave}),e.uploading=!0),e.$el.trigger(w.start,[n]),g(e)}function g(e){var t=0,n=[];for(var i in e.queue)!e.queue.hasOwnProperty(i)||e.queue[i].complete||e.queue[i].error||n.push(e.queue[i]);e.queue=n;for(var a in e.queue)if(e.queue.hasOwnProperty(a)){if(!e.queue[a].started){var o=new FormData;o.append(e.postKey,e.queue[a].file);for(var r in e.postData)e.postData.hasOwnProperty(r)&&o.append(r,e.postData[r]);m(e,o,e.queue[a])}if(t++,t>=e.maxQueue)return;i++}0===t&&(C.off(w.beforeUnload),e.uploading=!1,e.$el.trigger(w.complete))}function m(t,n,i){n=t.beforeSend.call(x,n,i),i.size>=t.maxSize||n===!1||i.error===!0?o(t,i,n?"size":"abort"):(i.started=!0,i.transfer=e.ajax({url:t.action,data:n,dataType:t.dataType,type:"POST",contentType:!1,processData:!1,cache:!1,xhr:function(){var n=e.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(e){var n=0,a=e.loaded||e.position,o=e.total;e.lengthComputable&&(n=Math.ceil(a/o*100)),t.$el.trigger(w.fileProgress,[i,n])},!1),n},beforeSend:function(){t.$el.trigger(w.fileStart,[i])},success:function(e){i.complete=!0,t.$el.trigger(w.fileComplete,[i,e]),g(t)},error:function(e,n,a){o(t,i,a)}}))}var v=t.Plugin("upload",{widget:!0,defaults:{action:"",beforeSend:function(e){return e},customClass:"",dataType:"html",label:"Drag and drop files or click to select",leave:"You have uploads pending, are you sure you want to leave this page?",maxQueue:2,maxSize:5242880,multiple:!0,postData:{},postKey:"file"},classes:["input","target","multiple","dropping","disabled"],methods:{_construct:n,_destruct:i,disable:r,enable:s,abort:a}}),b=v.classes,y=b.raw,w=v.events,$=v.functions,x=t.window,C=t.$window;w.complete="complete",w.fileStart="filestart",w.fileProgress="fileprogress",w.fileComplete="filecomplete",w.fileError="fileerror",w.start="start"}(jQuery,Formstone);
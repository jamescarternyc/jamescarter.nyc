!function(e,t,n){"use strict";function i(e){T.iterate.call(H,b)}function a(){H=e(x.base)}function o(t){t.youTubeGuid=0,t.$container=e('<div class="'+C.container+'"></div>').appendTo(this),this.addClass([C.base,t.customClass].join(" "));var n=t.source;t.source=null,s(t,n,!0),a()}function r(e){e.$container.remove(),this.removeClass([C.base,e.customClass].join(" ")).off(k.namespace),a()}function s(t,n,i){if(n!==t.source){if(t.source=n,t.responsive=!1,t.isYouTube=!1,"object"===e.type(n)&&"string"===e.type(n.video)){var a=n.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);a&&a.length>=1&&(t.isYouTube=!0,t.videoId=a[1])}var o=!t.isYouTube&&"object"===e.type(n)&&(n.hasOwnProperty("mp4")||n.hasOwnProperty("ogg")||n.hasOwnProperty("webm"));if(t.video=t.isYouTube||o,t.playing=!1,t.isYouTube)t.playerReady=!1,t.posterLoaded=!1,u(t,n,i);else if("object"===e.type(n)&&n.hasOwnProperty("poster"))d(t,n,i);else{var r=n;if("object"===e.type(n)){var f,s=[],p=[];for(f in n)n.hasOwnProperty(f)&&p.push(f);p.sort(T.sortAsc);for(f in p)p.hasOwnProperty(f)&&s.push({width:parseInt(p[f]),url:n[p[f]],mq:window.matchMedia("(min-width: "+parseInt(p[f])+"px)")});t.responsive=!0,t.sources=s,r=l(t)}c(t,r,!1,i)}}else t.$el.trigger(k.loaded)}function l(e){var n=e.source;if(e.responsive){n=e.sources[0].url;for(var i in e.sources)e.sources.hasOwnProperty(i)&&(t.support.nativeMatchMedia?e.sources[i].mq.matches&&(n=e.sources[i].url):e.sources[i].width<t.fallbackWidth&&(n=e.sources[i].url))}return n}function c(t,n,i,a){var o=[C.media,C.image,a!==!0?C.animated:""].join(" "),r=e('<div class="'+o+'"><img></div>'),s=r.find("img"),l=n;s.one(k.load,function(){j&&r.addClass(C["native"]).css({backgroundImage:"url('"+l+"')"}),r.fsTransition({property:"opacity"},function(){i||p(t)}).css({opacity:1}),y(t),(!i||a)&&t.$el.trigger(k.loaded)}).attr("src",l),t.responsive&&r.addClass(C.responsive),t.$container.append(r),(s[0].complete||4===s[0].readyState)&&s.trigger(k.load),t.currentSource=l}function d(n,i,a){if(n.source&&n.source.poster&&(c(n,n.source.poster,!0,!0),a=!1),!t.isMobile){var o=[C.media,C.video,a!==!0?C.animated:""].join(" "),r='<div class="'+o+'">';r+="<video",n.loop&&(r+=" loop"),n.mute&&(r+=" muted"),r+=">",n.source.webm&&(r+='<source src="'+n.source.webm+'" type="video/webm" />'),n.source.mp4&&(r+='<source src="'+n.source.mp4+'" type="video/mp4" />'),n.source.ogg&&(r+='<source src="'+n.source.ogg+'" type="video/ogg" />'),r+="</video>",r+="</div>";var s=e(r),l=s.find("video");l.one(k.loadedMetaData,function(e){s.fsTransition({property:"opacity"},function(){p(n)}).css({opacity:1}),y(n),n.$el.trigger(k.loaded),n.autoPlay&&g(n)}),n.$container.append(s)}}function u(n,i,a){if(!n.videoId){var o=i.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);n.videoId=o[1]}if(n.posterLoaded||(n.source.poster||(n.source.poster="http://img.youtube.com/vi/"+n.videoId+"/0.jpg"),n.posterLoaded=!0,c(n,n.source.poster,!0,a),a=!1),!t.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"></script>'),W){var r=n.guid+"_"+n.youTubeGuid++,s=[C.media,C.embed,a!==!0?C.animated:""].join(" "),l='<div class="'+s+'">';l+='<div id="'+r+'"></div>',l+="</div>";var d=e(l),u=e.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:r,loop:n.loop?1:0,autoplay:1,origin:E.location.protocol+"//"+E.location.host},n.youtubeOptions);n.$container.append(d),n.player&&(n.oldPlayer=n.player,n.player=null),n.player=new E.YT.Player(r,{videoId:n.videoId,playerVars:u,events:{onReady:function(e){n.playerReady=!0,n.mute&&n.player.mute(),n.autoPlay&&n.player.playVideo()},onStateChange:function(e){n.playing||e.data!==E.YT.PlayerState.PLAYING?n.loop&&n.playing&&e.data===E.YT.PlayerState.ENDED&&n.player.playVideo():(n.playing=!0,n.autoPlay||n.player.pauseVideo(),d.fsTransition({property:"opacity"},function(){p(n)}).css({opacity:1}),y(n),n.$el.trigger(k.loaded)),n.$el.find(x.embed).addClass(C.ready)},onPlaybackQualityChange:function(e){},onPlaybackRateChange:function(e){},onError:function(e){},onApiChange:function(e){}}}),y(n)}else M.push({data:n,source:i})}function p(e){var t=e.$container.find(x.media);t.length>=1&&(t.not(":last").remove(),e.oldPlayer=null)}function f(e){var t=e.$container.find(x.media);t.length>=1&&t.fsTransition({property:"opacity"},function(){t.remove(),delete e.source}).css({opacity:0})}function h(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var t=e.$container.find("video");t.length&&t[0].pause()}e.playing=!1}}function g(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var t=e.$container.find("video");t.length&&t[0].play()}e.playing=!0}}function m(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.mute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!0)}e.playing=!0}}function v(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.unMute();else{var t=e.$container.find("video");t.length&&(t[0].muted=!1)}e.playing=!0}}function b(e){if(e.responsive){var t=l(e);t!==e.currentSource?c(e,t,!1,!0):y(e)}else y(e)}function y(e){for(var t=e.$container.find(x.media),n=0,i=t.length;i>n;n++){var a=t.eq(n),o=e.isYouTube?"iframe":a.find("video").length?"video":"img",r=a.find(o);if(r.length&&("img"!==o||!j)){var s=e.$el.outerWidth(),l=e.$el.outerHeight(),d=w(e,r);e.width=d.width,e.height=d.height,e.left=0,e.top=0;var u=e.isYouTube?e.embedRatio:e.width/e.height;e.height=l,e.width=e.height*u,e.width<s&&(e.width=s,e.height=e.width/u),e.left=-(e.width-s)/2,e.top=-(e.height-l)/2,a.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function w(t,n){if(t.isYouTube)return{height:500,width:500/t.embedRatio};if(n.is("img")){var i=n[0];if("undefined"!==e.type(i.naturalHeight))return{height:i.naturalHeight,width:i.naturalWidth};var a=new Image;return a.src=i.src,{height:a.height,width:a.width}}return{height:n[0].videoHeight,width:n[0].videoWidth}}var $=t.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:o,_destruct:r,_resize:i,play:g,pause:h,mute:m,unmute:v,resize:y,load:s,unload:f}}),x=$.classes,C=x.raw,k=$.events,T=$.functions,E=t.window,H=[],j="backgroundSize"in t.document.documentElement.style,W=!1,M=[];E.onYouTubeIframeAPIReady=function(){W=!0;for(var e in M)M.hasOwnProperty(e)&&u(M[e].data,M[e].source);M=[]}}(jQuery,Formstone);
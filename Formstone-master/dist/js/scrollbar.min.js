!function(e,t){"use strict";function n(){m=t.$body}function i(){$.iterate.call(x,l)}function a(){x=e(b.base)}function o(e){var t="";t+='<div class="'+y.bar+'">',t+='<div class="'+y.track+'">',t+='<span class="'+y.handle+'"></span>',t+="</div></div>",e.paddingRight=parseInt(this.css("padding-right"),10),e.paddingBottom=parseInt(this.css("padding-bottom"),10),this.addClass([y.base,e.customClass,e.horizontal?y.horizontal:""].join(" ")).wrapInner('<div class="'+y.content+'" />').prepend(t),e.$content=this.find(b.content),e.$bar=this.find(b.bar),e.$track=this.find(b.track),e.$handle=this.find(b.handle),e.trackMargin=parseInt(e.trackMargin,10),e.$content.on(w.scroll,e,c),e.mouseWheel&&e.$content.on("DOMMouseScroll"+w.namespace+" mousewheel"+w.namespace,e,d),e.$track.fsTouch({axis:e.horizontal?"x":"y",pan:!0}).on(w.panStart,e,p).on(w.pan,e,h).on(w.panEnd,e,f),l(e),a()}function r(e){e.$track.fsTouch("destroy"),e.$bar.remove(),e.$content.off(w.namespace).contents().unwrap(),this.removeClass([y.base,y.active,e.customClass].join(" ")).off(w.namespace)}function s(t,n,i){var a=i||t.duration,o={};if("number"!==e.type(n)){var r=e(n);if(r.length>0){var s=r.position();n=t.horizontal?s.left+t.$content.scrollLeft():s.top+t.$content.scrollTop()}else n="top"===n?0:"bottom"===n?t.horizontal?t.$content[0].scrollWidth:t.$content[0].scrollHeight:t.$content.scrollTop()}o[t.horizontal?"scrollLeft":"scrollTop"]=n,t.$content.stop().animate(o,a)}function l(e){e.$el.addClass(y.isSetup);var t={},n={},i={},a=0,o=!0;if(e.horizontal){e.barHeight=e.$content[0].offsetHeight-e.$content[0].clientHeight,e.frameWidth=e.$content.outerWidth(),e.trackWidth=e.frameWidth-2*e.trackMargin,e.scrollWidth=e.$content[0].scrollWidth,e.ratio=e.trackWidth/e.scrollWidth,e.trackRatio=e.trackWidth/e.scrollWidth,e.handleWidth=e.handleSize>0?e.handleSize:e.trackWidth*e.trackRatio,e.scrollRatio=(e.scrollWidth-e.frameWidth)/(e.trackWidth-e.handleWidth),e.handleBounds={left:0,right:e.trackWidth-e.handleWidth},e.$content.css({paddingBottom:e.barHeight+e.paddingBottom});var r=e.$content.scrollLeft();a=r*e.ratio,o=e.scrollWidth<=e.frameWidth,t={width:e.frameWidth},n={width:e.trackWidth,marginLeft:e.trackMargin,marginRight:e.trackMargin},i={width:e.handleWidth}}else{e.barWidth=e.$content[0].offsetWidth-e.$content[0].clientWidth,e.frameHeight=e.$content.outerHeight(),e.trackHeight=e.frameHeight-2*e.trackMargin,e.scrollHeight=e.$content[0].scrollHeight,e.ratio=e.trackHeight/e.scrollHeight,e.trackRatio=e.trackHeight/e.scrollHeight,e.handleHeight=e.handleSize>0?e.handleSize:e.trackHeight*e.trackRatio,e.scrollRatio=(e.scrollHeight-e.frameHeight)/(e.trackHeight-e.handleHeight),e.handleBounds={top:0,bottom:e.trackHeight-e.handleHeight};var s=e.$content.scrollTop();a=s*e.ratio,o=e.scrollHeight<=e.frameHeight,t={height:e.frameHeight},n={height:e.trackHeight,marginBottom:e.trackMargin,marginTop:e.trackMargin},i={height:e.handleHeight}}o?e.$el.removeClass(y.active):e.$el.addClass(y.active),e.$bar.css(t),e.$track.css(n),e.$handle.css(i),e.panning=!1,g(e,a),c({data:e}),e.$el.removeClass(y.setup)}function c(e){$.killEvent(e);var t=e.data,n={};if(!t.panning){if(t.horizontal){var i=t.$content.scrollLeft();0>i&&(i=0),t.handleLeft=i/t.scrollRatio,t.handleLeft>t.handleBounds.right&&(t.handleLeft=t.handleBounds.right),n={left:t.handleLeft}}else{var a=t.$content.scrollTop();0>a&&(a=0),t.handleTop=a/t.scrollRatio,t.handleTop>t.handleBounds.bottom&&(t.handleTop=t.handleBounds.bottom),n={top:t.handleTop}}t.$handle.css(n)}}function d(e){var t,n,i=e.data;if(i.horizontal){var a=i.$content[0].scrollLeft,o=i.$content[0].scrollWidth,r=i.$content.outerWidth();if(t="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,n=t>0?"right":"left","left"===n&&-t>o-r-a)return i.$content.scrollLeft(o),u(e);if("right"===n&&t>a)return i.$content.scrollLeft(0),u(e)}else{var s=i.$content[0].scrollTop,l=i.$content[0].scrollHeight,c=i.$content.outerHeight();if(t="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,n=t>0?"up":"down","down"===n&&-t>l-c-s)return i.$content.scrollTop(l),u(e);if("up"===n&&t>s)return i.$content.scrollTop(0),u(e)}}function u(e){return $.killEvent(e),e.returnValue=!1,!1}function p(e){var t,n=e.data,i=n.$track.offset();n.panning=!0,t=n.horizontal?n.handleLeft=e.pageX-i.left-n.handleWidth/2:n.handleTop=e.pageY-i.top-n.handleHeight/2,g(n,t)}function h(e){var t,n=e.data;t=n.horizontal?n.handleLeft+e.deltaX:n.handleTop+e.deltaY,g(n,t)}function f(e){var t=e.data;t.panning=!1,t.horizontal?t.handleLeft+=e.deltaX:t.handleTop+=e.deltaY}function g(e,t){var n={};e.horizontal?(t<e.handleBounds.left&&(t=e.handleBounds.left),t>e.handleBounds.right&&(t=e.handleBounds.right),n={left:t},e.$content.scrollLeft(Math.round(t*e.scrollRatio))):(t<e.handleBounds.top&&(t=e.handleBounds.top),t>e.handleBounds.bottom&&(t=e.handleBounds.bottom),n={top:t},e.$content.scrollTop(Math.round(t*e.scrollRatio))),e.$handle.css(n)}var m,v=t.Plugin("scrollbar",{widget:!0,defaults:{customClass:"",duration:0,handleSize:0,horizontal:!1,mouseWheel:!0,trackMargin:0},classes:["content","bar","track","handle","horizontal","setup","active"],methods:{_setup:n,_construct:o,_destruct:r,_resize:i,scroll:s,resize:l}}),b=v.classes,y=b.raw,w=v.events,$=v.functions,x=(t.$window,[])}(jQuery,Formstone);
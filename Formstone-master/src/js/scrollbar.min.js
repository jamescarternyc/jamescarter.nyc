!function(e,t,i){"use strict";function n(){x=t.$body}function a(e){$.iterate.call(k,c)}function o(){k=e(b.base)}function r(e){var t="";t+='<div class="'+y.bar+'">',t+='<div class="'+y.track+'">',t+='<span class="'+y.handle+'"></span>',t+="</div></div>",e.paddingRight=parseInt(this.css("padding-right"),10),e.paddingBottom=parseInt(this.css("padding-bottom"),10),this.addClass([y.base,e.customClass,e.horizontal?y.horizontal:""].join(" ")).wrapInner('<div class="'+y.content+'" />').prepend(t),e.$content=this.find(b.content),e.$bar=this.find(b.bar),e.$track=this.find(b.track),e.$handle=this.find(b.handle),e.trackMargin=parseInt(e.trackMargin,10),e.$content.on(w.scroll,e,d),e.mouseWheel&&e.$content.on("DOMMouseScroll"+w.namespace+" mousewheel"+w.namespace,e,u),e.$track.fsTouch({axis:e.horizontal?"x":"y",pan:!0}).on(w.panStart,e,f).on(w.pan,e,h).on(w.panEnd,e,g),c(e),o()}function s(e){e.$track.fsTouch("destroy"),e.$bar.remove(),e.$content.off(w.namespace).contents().unwrap(),this.removeClass([y.base,y.active,e.customClass].join(" ")).off(w.namespace)}function l(t,i,n){var a=n||t.duration,o={};if("number"!==e.type(i)){var r=e(i);if(r.length>0){var s=r.position();i=t.horizontal?s.left+t.$content.scrollLeft():s.top+t.$content.scrollTop()}else i="top"===i?0:"bottom"===i?t.horizontal?t.$content[0].scrollWidth:t.$content[0].scrollHeight:t.$content.scrollTop()}o[t.horizontal?"scrollLeft":"scrollTop"]=i,t.$content.stop().animate(o,a)}function c(e){e.$el.addClass(y.isSetup);var t={},i={},n={},a=0,o=!0;if(e.horizontal){e.barHeight=e.$content[0].offsetHeight-e.$content[0].clientHeight,e.frameWidth=e.$content.outerWidth(),e.trackWidth=e.frameWidth-2*e.trackMargin,e.scrollWidth=e.$content[0].scrollWidth,e.ratio=e.trackWidth/e.scrollWidth,e.trackRatio=e.trackWidth/e.scrollWidth,e.handleWidth=e.handleSize>0?e.handleSize:e.trackWidth*e.trackRatio,e.scrollRatio=(e.scrollWidth-e.frameWidth)/(e.trackWidth-e.handleWidth),e.handleBounds={left:0,right:e.trackWidth-e.handleWidth},e.$content.css({paddingBottom:e.barHeight+e.paddingBottom});var r=e.$content.scrollLeft();a=r*e.ratio,o=e.scrollWidth<=e.frameWidth,t={width:e.frameWidth},i={width:e.trackWidth,marginLeft:e.trackMargin,marginRight:e.trackMargin},n={width:e.handleWidth}}else{e.barWidth=e.$content[0].offsetWidth-e.$content[0].clientWidth,e.frameHeight=e.$content.outerHeight(),e.trackHeight=e.frameHeight-2*e.trackMargin,e.scrollHeight=e.$content[0].scrollHeight,e.ratio=e.trackHeight/e.scrollHeight,e.trackRatio=e.trackHeight/e.scrollHeight,e.handleHeight=e.handleSize>0?e.handleSize:e.trackHeight*e.trackRatio,e.scrollRatio=(e.scrollHeight-e.frameHeight)/(e.trackHeight-e.handleHeight),e.handleBounds={top:0,bottom:e.trackHeight-e.handleHeight};var s=e.$content.scrollTop();a=s*e.ratio,o=e.scrollHeight<=e.frameHeight,t={height:e.frameHeight},i={height:e.trackHeight,marginBottom:e.trackMargin,marginTop:e.trackMargin},n={height:e.handleHeight}}o?e.$el.removeClass(y.active):e.$el.addClass(y.active),e.$bar.css(t),e.$track.css(i),e.$handle.css(n),e.panning=!1,m(e,a),d({data:e}),e.$el.removeClass(y.setup)}function d(e){$.killEvent(e);var t=e.data,i={};if(!t.panning){if(t.horizontal){var n=t.$content.scrollLeft();0>n&&(n=0),t.handleLeft=n/t.scrollRatio,t.handleLeft>t.handleBounds.right&&(t.handleLeft=t.handleBounds.right),i={left:t.handleLeft}}else{var a=t.$content.scrollTop();0>a&&(a=0),t.handleTop=a/t.scrollRatio,t.handleTop>t.handleBounds.bottom&&(t.handleTop=t.handleBounds.bottom),i={top:t.handleTop}}t.$handle.css(i)}}function u(e){var i,n,t=e.data;if(t.horizontal){var a=t.$content[0].scrollLeft,o=t.$content[0].scrollWidth,r=t.$content.outerWidth();if(i="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,n=i>0?"right":"left","left"===n&&-i>o-r-a)return t.$content.scrollLeft(o),p(e);if("right"===n&&i>a)return t.$content.scrollLeft(0),p(e)}else{var s=t.$content[0].scrollTop,l=t.$content[0].scrollHeight,c=t.$content.outerHeight();if(i="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,n=i>0?"up":"down","down"===n&&-i>l-c-s)return t.$content.scrollTop(l),p(e);if("up"===n&&i>s)return t.$content.scrollTop(0),p(e)}}function p(e){return $.killEvent(e),e.returnValue=!1,!1}function f(e){var n,t=e.data,i=t.$track.offset();t.panning=!0,n=t.horizontal?t.handleLeft=e.pageX-i.left-t.handleWidth/2:t.handleTop=e.pageY-i.top-t.handleHeight/2,m(t,n)}function h(e){var i,t=e.data;i=t.horizontal?t.handleLeft+e.deltaX:t.handleTop+e.deltaY,m(t,i)}function g(e){var t=e.data;t.panning=!1,t.horizontal?t.handleLeft+=e.deltaX:t.handleTop+=e.deltaY}function m(e,t){var i={};e.horizontal?(t<e.handleBounds.left&&(t=e.handleBounds.left),t>e.handleBounds.right&&(t=e.handleBounds.right),i={left:t},e.$content.scrollLeft(Math.round(t*e.scrollRatio))):(t<e.handleBounds.top&&(t=e.handleBounds.top),t>e.handleBounds.bottom&&(t=e.handleBounds.bottom),i={top:t},e.$content.scrollTop(Math.round(t*e.scrollRatio))),e.$handle.css(i)}var x,v=t.Plugin("scrollbar",{widget:!0,defaults:{customClass:"",duration:0,handleSize:0,horizontal:!1,mouseWheel:!0,trackMargin:0},classes:["content","bar","track","handle","horizontal","setup","active"],methods:{_setup:n,_construct:r,_destruct:s,_resize:a,scroll:l,resize:c}}),b=v.classes,y=b.raw,w=v.events,$=v.functions,k=(t.$window,[])}(jQuery,Formstone);
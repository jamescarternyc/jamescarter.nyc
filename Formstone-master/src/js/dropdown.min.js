!function(e,t,i){"use strict";function n(){D=t.$body}function a(n){n.multiple=this.prop("multiple"),n.disabled=this.is(":disabled"),n.multiple?n.links=!1:n.external&&(n.links=!0);var a=this.find("[selected]").not(":disabled"),o=this.find(":selected").not(":disabled"),r=o.text(),s=this.find("option").index(o);n.multiple||""===n.label||a.length?n.label="":(o=this.prepend('<option value="" class="'+_.item_placeholder+'" selected>'+n.label+"</option>"),r=n.label,s=0);var l=this.find("option, optgroup"),u=l.filter("option");n.tabIndex=this[0].tabIndex,this[0].tabIndex=-1;var p=[_.base,n.customClass];n.mobile||t.isMobile?p.push(_.mobile):n.cover&&p.push(_.cover),n.multiple&&p.push(_.multiple),n.disabled&&p.push(_.disabled);var f='<div class="'+p.join(" ")+'" tabindex="'+n.tabIndex+'"></div>',h="";n.multiple||(h+='<button type="button" class="'+_.selected+'">',h+=e("<span></span>").text(T(r,n.trim)).html(),h+="</button>"),h+='<div class="'+_.options+'">',h+="</div>",this.wrap(f).after(h),n.$dropdown=this.parent(M.base),n.$allOptions=l,n.$options=u,n.$selected=n.$dropdown.find(M.selected),n.$wrapper=n.$dropdown.find(M.options),n.$placeholder=n.$dropdown.find(M.placeholder),n.index=-1,n.closed=!0,n.focused=!1,c(n),n.multiple||$(s,n),e.fn.fsScrollbar!==i&&n.$wrapper.fsScrollbar(),n.$selected.on(j.click,n,d),n.$dropdown.on(j.click,M.item,n,m).on(j.close,n,g),this.on(j.change,n,v),t.isMobile||(n.$dropdown.on(j.focusIn,n,b).on(j.focusOut,n,y),this.on(j.focusIn,n,function(e){e.data.$dropdown.trigger(j.raw.focusIn)}))}function o(t){t.$dropdown.hasClass(_.open)&&t.$selected.trigger(j.click),e.fn.fsScrollbar!==i&&t.$wrapper.fsScrollbar("destroy"),t.$el[0].tabIndex=t.tabIndex,t.$dropdown.off(j.namespace),t.$options.off(j.namespace),t.$placeholder.remove(),t.$selected.remove(),t.$wrapper.remove(),t.$el.off(j.namespace).show().unwrap()}function r(e,t){if("undefined"!=typeof t){var i=e.$items.index(e.$items.filter("[data-value="+t+"]"));e.$items.eq(i).addClass(_.item_disabled),e.$options.eq(i).prop("disabled",!0)}else e.$dropdown.hasClass(_.open)&&e.$selected.trigger(j.click),e.$dropdown.addClass(_.disabled),e.$el.prop("disabled",!0),e.disabled=!0}function s(e,t){if("undefined"!=typeof t){var i=e.$items.index(e.$items.filter("[data-value="+t+"]"));e.$items.eq(i).removeClass(_.item_disabled),e.$options.eq(i).prop("disabled",!1)}else e.$dropdown.removeClass(_.disabled),e.$el.prop("disabled",!1),e.disabled=!1}function l(e){var t=e.index;e.$allOptions=e.$el.find("option, optgroup"),e.$options=e.$allOptions.filter("option"),e.index=-1,t=e.$options.index(e.$options.filter(":selected")),c(e),e.multiple||$(t,e)}function c(t){for(var i="",n=0,a=0,o=t.$allOptions.length;o>a;a++){var r=t.$allOptions.eq(a),s=[];if("OPTGROUP"===r[0].tagName)s.push(_.group),r.is(":disabled")&&s.push(_.disabled),i+='<span class="'+s.join(" ")+'">'+r.attr("label")+"</span>";else{var l=r.val(),c=r.data("label");r.attr("value")||r.attr("value",l),s.push(_.item),r.hasClass(_.item_placeholder)&&s.push(_.item_placeholder),r.is(":selected")&&s.push(_.item_selected),r.is(":disabled")&&s.push(_.item_disabled),i+='<button type="button" class="'+s.join(" ")+'" ',i+='data-value="'+l+'">',i+=c?c:W.decodeEntities(T(r.text(),t.trim)),i+="</button>",n++}}t.$items=t.$wrapper.html(e.parseHTML(i)).find(M.item)}function d(e){W.killEvent(e);var i=e.data;if(!i.disabled)if(i.mobile||!t.isMobile||t.isFirefoxMobile)i.closed?p(i):f(i);else{var n=i.$el[0];if(I.createEvent){var a=I.createEvent("MouseEvents");a.initMouseEvent("mousedown",!1,!0,S,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(a)}else n.fireEvent&&n.fireEvent("onmousedown")}u(i)}function u(t){e(M.base).not(t.$dropdown).trigger(j.close,[t])}function p(e){if(e.closed){var t=e.$dropdown.offset(),i=D.outerHeight(),n=e.$wrapper.outerHeight(!0);e.index>=0?e.$items.eq(e.index).position():{left:0,top:0};t.top+n>i-e.bottomEdge&&e.$dropdown.addClass(_.bottom),D.on(j.click+e.dotGuid,":not("+M.options+")",e,h),e.$dropdown.trigger(j.focusIn),e.$dropdown.addClass(_.open),x(e),e.closed=!1}}function f(e){e&&!e.closed&&(D.off(j.click+e.dotGuid),e.$dropdown.removeClass([_.open,_.bottom].join(" ")),e.closed=!0)}function h(t){W.killEvent(t);var i=t.data;i&&0===e(t.currentTarget).parents(M.base).length&&(f(i),i.$dropdown.trigger(j.focusOut))}function g(e){var t=e.data;t&&(f(t),t.$dropdown.trigger(j.focusOut))}function m(t){W.killEvent(t);var i=e(this),n=t.data;if(!n.disabled){if(n.$wrapper.is(":visible")){var a=n.$items.index(i);a!==n.index&&($(a,n),C(n))}n.multiple||f(n),n.$dropdown.trigger(j.focusIn)}}function v(t,i){var n=e(this),a=t.data;if(!i&&!a.multiple){var o=a.$options.index(a.$options.filter("[value='"+E(n.val())+"']"));$(o,a),C(a)}}function b(t){W.killEvent(t);var n=(e(t.currentTarget),t.data);n.disabled||n.multiple||n.focused||(u(n),n.focused=!0,n.$dropdown.addClass(_.focus).on(j.keyDown+n.dotGuid,n,w))}function y(t,i){W.killEvent(t);var a=(e(t.currentTarget),t.data);a.focused&&a.closed&&(a.focused=!1,a.$dropdown.removeClass(_.focus).off(j.keyDown+a.dotGuid),a.multiple||f(a))}function w(i){var n=i.data;if(13===i.keyCode)n.closed||(f(n),$(n.index,n)),C(n);else if(!(9===i.keyCode||i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)){W.killEvent(i);var a=n.$items.length-1,o=n.index<0?0:n.index;if(e.inArray(i.keyCode,t.isFirefox?[38,40,37,39]:[38,40])>-1)o+=38===i.keyCode||t.isFirefox&&37===i.keyCode?-1:1,0>o&&(o=0),o>a&&(o=a);else{var s,l,r=String.fromCharCode(i.keyCode).toUpperCase();for(l=n.index+1;a>=l;l++)if(s=n.$options.eq(l).text().charAt(0).toUpperCase(),s===r){o=l;break}if(0>o||o===n.index)for(l=0;a>=l;l++)if(s=n.$options.eq(l).text().charAt(0).toUpperCase(),s===r){o=l;break}}o>=0&&($(o,n),x(n))}}function $(e,t){var i=t.$items.eq(e),n=t.$options.eq(e),a=i.hasClass(_.item_selected),o=i.hasClass(_.item_disabled);if(!o)if(t.multiple)a?(n.prop("selected",null),i.removeClass(_.item_selected)):(n.prop("selected",!0),i.addClass(_.item_selected));else if(e>-1&&e<t.$items.length){var r=n.data("label")||i.html();t.$selected.html(r).removeClass(M.item_placeholder),t.$items.filter(M.item_selected).removeClass(_.item_selected),t.$el[0].selectedIndex=e,i.addClass(_.item_selected),t.index=e}else""!==t.label&&t.$selected.html(t.label)}function x(t){var n=t.$items.eq(t.index),a=t.index>=0&&!n.hasClass(_.item_placeholder)?n.position():{left:0,top:0},o=(t.$wrapper.outerHeight()-n.outerHeight())/2;e.fn.fsScrollbar!==i?t.$wrapper.fsScrollbar("resize").fsScrollbar("scroll",t.$wrapper.find(".fs-scrollbar-content").scrollTop()+a.top):t.$wrapper.scrollTop(t.$wrapper.scrollTop()+a.top-o)}function C(e){e.links?k(e):e.$el.trigger(j.raw.change,[!0])}function k(e){var t=e.$el.val();e.external?S.open(t):S.location.href=t}function T(e,t){return 0===t?e:e.length>t?e.substring(0,t)+"...":e}function E(e){return"string"==typeof e?e.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"):e}var H=t.Plugin("dropdown",{widget:!0,defaults:{bottomEdge:0,cover:!1,customClass:"",label:"",external:!1,links:!1,mobile:!1,trim:0},methods:{_setup:n,_construct:a,_destruct:o,disable:r,enable:s,update:l,open:p,close:f},classes:["cover","bottom","multiple","mobile","open","disabled","focus","selected","options","group","item","item_disabled","item_selected","item_placeholder"],events:{close:"close"}}),M=H.classes,_=M.raw,j=H.events,W=H.functions,S=t.window,I=(t.$window,t.document),D=null}(jQuery,Formstone);
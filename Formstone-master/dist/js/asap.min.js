!function(e,t,n){"use strict";function i(n){!v&&t.support.history&&(g=t.$body,v=e.extend(b,n),v.render===e.noop&&(v.render=c),v.transitionOut===e.noop&&(v.transitionOut=function(){return e.Deferred().resolve()}),history.state?(S=history.state.id,E=history.state.url):(E=window.location.href,f(S,E)),w.on(C.popState,r),o())}function o(){g&&!g.hasClass(T.base)&&g.on(C.click,b.selector,a).addClass(T.base)}function a(e){var t=e.currentTarget;e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||window.location.protocol!==t.protocol||window.location.host!==t.host||"_blank"===t.target||(!t.hash||t.href.replace(t.hash,"")!==window.location.href.replace(location.hash,"")&&t.href!==window.location.href+"#")&&($.killEvent(e),e.stopImmediatePropagation(),t.href!==E&&s(t.href,!0))}function r(e){m&&m.abort();var t=e.originalEvent.state;S=t.id,t.url!==E&&s(t.url,!1)}function s(t,n){m&&m.abort(),w.trigger(C.requested,[!1]),v.transitionOutDeferred=v.transitionOut.apply(x,[!1]);var i=h(t),o=i.params,a=i.hash,r=i.clean,s="User error",c=null,d=e.Deferred();o[v.requestKey]=!0,m=e.ajax({url:r,data:o,dataType:"json",cache:v.cache,xhr:function(){var e=new x.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;w.trigger(C.progress,[t])}},!1),e},success:function(n){c="string"===e.type(n)?e.parseJSON(n):n,n.location&&(t=n.location,i=h(t),a=i.hash),d.resolve()},error:function(e,t,n){s=n,d.reject()}}),e.when(d,v.transitionOutDeferred).done(function(){l(i,c,n)}).fail(function(){w.trigger(C.failed,[s])})}function l(t,i,o){w.trigger(C.loaded,[i]),e.fsAnalytics!==n&&e.fsAnalytics("pageview"),v.render.call(this,i,t.hash),E=t.url,o&&(S++,p(S,E)),w.trigger(C.rendered,[i]);var a=!1;if(""!==t.hash){var r=e(t.hash);r.length&&(a=r.offset().top)}a!==!1&&w.scrollTop(a)}function c(t){if("undefined"!==e.type(t)){var n;for(var i in t)t.hasOwnProperty(i)&&(n=e(i),n.length&&n.html(t[i]))}}function d(e){v&&t.support.history?e&&s(e,!0):window.location.href=e}function u(e){var t=history.state;E=e,f(t.id,e)}function p(e,t){history.pushState({id:e,url:t},k+e,t)}function f(e,t){history.replaceState({id:e,url:t},k+e,t)}function h(e){var t=e.indexOf("?"),n=e.indexOf("#"),i={},o="",a=e;return n>-1&&(o=e.slice(n),a=e.slice(0,n)),t>-1&&(i=$.parseQueryString(e.slice(t+1,n>-1?n:e.length)),a=e.slice(0,t)),{hash:o,params:i,url:e,clean:a}}var g,m,v,y=t.Plugin("asap",{utilities:{_initialize:i,load:d,replace:u},events:{failed:"failed",loaded:"loaded",popState:"popstate",progress:"progress",requested:"requested",rendered:"rendered"}}),b={cache:!0,selector:"a",render:e.noop,requestKey:"fs-asap",transitionOut:e.noop},w=t.$window,x=w[0],$=y.functions,C=y.events,T=y.classes.raw,k="asap-",E="",S=1}(jQuery,Formstone);
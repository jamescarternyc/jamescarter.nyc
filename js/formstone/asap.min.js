!function(e,t,i){"use strict";function n(i){!v&&t.support.history&&(g=t.$body,v=e.extend(y,i),v.render===e.noop&&(v.render=c),v.transitionOut===e.noop&&(v.transitionOut=function(){return e.Deferred().resolve()}),history.state?(E=history.state.id,H=history.state.url):(H=window.location.href,f(E,H)),w.on(C.popState,r),a())}function a(){g&&!g.hasClass(k.base)&&g.on(C.click,y.selector,o).addClass(k.base)}function o(e){var t=e.currentTarget;e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||window.location.protocol!==t.protocol||window.location.host!==t.host||"_blank"===t.target||(!t.hash||t.href.replace(t.hash,"")!==window.location.href.replace(location.hash,"")&&t.href!==window.location.href+"#")&&(x.killEvent(e),e.stopImmediatePropagation(),t.href!==H&&s(t.href,!0))}function r(e){m&&m.abort();var t=e.originalEvent.state;E=t.id,t.url!==H&&s(t.url,!1)}function s(t,i){m&&m.abort(),w.trigger(C.requested,[!1]),v.transitionOutDeferred=v.transitionOut.apply($,[!1]);var n=h(t),a=n.params,o=n.hash,r=n.clean,s="User error",c=null,d=e.Deferred();a[v.requestKey]=!0,m=e.ajax({url:r,data:a,dataType:"json",cache:v.cache,xhr:function(){var e=new $.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;w.trigger(C.progress,[t])}},!1),e},success:function(i){c="string"===e.type(i)?e.parseJSON(i):i,i.location&&(t=i.location,n=h(t),o=n.hash),d.resolve()},error:function(e,t,i){s=i,d.reject()}}),e.when(d,v.transitionOutDeferred).done(function(){l(n,c,i)}).fail(function(){w.trigger(C.failed,[s])})}function l(t,n,a){w.trigger(C.loaded,[n]),e.fsAnalytics!==i&&e.fsAnalytics("pageview"),v.render.call(this,n,t.hash),H=t.url,a&&(E++,p(E,H)),w.trigger(C.rendered,[n]);var o=!1;if(""!==t.hash){var r=e(t.hash);r.length&&(o=r.offset().top)}o!==!1&&w.scrollTop(o)}function c(t){if("undefined"!==e.type(t)){var i;for(var n in t)t.hasOwnProperty(n)&&(i=e(n),i.length&&i.html(t[n]))}}function d(e){v&&t.support.history?e&&s(e,!0):window.location.href=e}function u(e){var t=history.state;H=e,f(t.id,e)}function p(e,t){history.pushState({id:e,url:t},T+e,t)}function f(e,t){history.replaceState({id:e,url:t},T+e,t)}function h(e){var t=e.indexOf("?"),i=e.indexOf("#"),n={},a="",o=e;return i>-1&&(a=e.slice(i),o=e.slice(0,i)),t>-1&&(n=x.parseQueryString(e.slice(t+1,i>-1?i:e.length)),o=e.slice(0,t)),{hash:a,params:n,url:e,clean:o}}var g,m,v,b=t.Plugin("asap",{utilities:{_initialize:n,load:d,replace:u},events:{failed:"failed",loaded:"loaded",popState:"popstate",progress:"progress",requested:"requested",rendered:"rendered"}}),y={cache:!0,selector:"a",render:e.noop,requestKey:"fs-asap",transitionOut:e.noop},w=t.$window,$=w[0],x=b.functions,C=b.events,k=b.classes.raw,T="asap-",H="",E=1}(jQuery,Formstone);
!function(e,t){"use strict";function i(e){e.touches=[],e.touching=!1,this.on(v.dragStart,b.killEvent),e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on(v.touchStart,e,o).on(v.click,e,d),t.support.touch&&t.support.pointer&&this.on(v.pointerDown,e,o)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):h(this,"none"),this.on(v.touchStart,e,a).on(v.mouseDown,e,o),t.support.touch&&t.support.pointer&&this.on(v.pointerDown,e,a))}function n(){this.off(v.namespace),h(this,"")}function a(e){e.preventManipulation&&e.preventManipulation();var t=e.data,i=e.originalEvent;if(i.type.match(/(up|end|cancel)$/i))return void c(e);if(i.pointerId){var n=!1;for(var a in t.touches)t.touches[a].id===i.pointerId&&(n=!0,t.touches[a].pageX=i.clientX,t.touches[a].pageY=i.clientY);n||t.touches.push({id:i.pointerId,pageX:i.clientX,pageY:i.clientY})}else t.touches=i.touches;i.type.match(/(down|start)$/i)?o(e):i.type.match(/move$/i)&&s(e)}function o(t){var i=t.data,n="undefined"!==e.type(i.touches)?i.touches[0]:null;if(i.touching||(i.startE=t.originalEvent,i.startX=n?n.pageX:t.pageX,i.startY=n?n.pageY:t.pageY,i.startT=(new Date).getTime(),i.scaleD=1,i.passed=!1),i.tap)i.clicked=!1,i.$el.on([v.touchMove,v.pointerMove].join(" "),i,a).on([v.touchEnd,v.touchCancel,v.pointerUp,v.pointerCancel].join(" "),i,a);else if(i.pan||i.scale){i.$links&&i.$links.off(v.click);var o=u(i.scale?v.scaleStart:v.panStart,t,i.startX,i.startY,i.scaleD,0,0,"","");if(i.scale&&i.touches&&i.touches.length>=2){var r=i.touches;i.pinch={startX:p(r[0].pageX,r[1].pageX),startY:p(r[0].pageY,r[1].pageY),startD:f(r[1].pageX-r[0].pageX,r[1].pageY-r[0].pageY)},o.pageX=i.startX=i.pinch.startX,o.pageY=i.startY=i.pinch.startY}i.touching||(i.touching=!0,i.pan&&y.on(v.mouseMove,i,s).on(v.mouseUp,i,c),y.on([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel].join(" "),i,a),i.$el.trigger(o))}}function s(t){var i=t.data,n="undefined"!==e.type(i.touches)?i.touches[0]:null,a=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=a-i.startX,r=o-i.startY,l=s>0?"right":"left",d=r>0?"down":"up",h=Math.abs(s)>w,g=Math.abs(r)>w;if(i.tap)(h||g)&&i.$el.off([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel].join(" "));else if(i.pan||i.scale)if(!i.passed&&i.axis&&(i.axisX&&g||i.axisY&&h))c(t);else{!i.passed&&(!i.axis||i.axis&&i.axisX&&h||i.axisY&&g)&&(i.passed=!0),i.passed&&(b.killEvent(t),b.killEvent(i.startE));var m=!0,y=u(i.scale?v.scale:v.pan,t,a,o,i.scaleD,s,r,l,d);if(i.scale)if(i.touches&&i.touches.length>=2){var $=i.touches;i.pinch.endX=p($[0].pageX,$[1].pageX),i.pinch.endY=p($[0].pageY,$[1].pageY),i.pinch.endD=f($[1].pageX-$[0].pageX,$[1].pageY-$[0].pageY),i.scaleD=i.pinch.endD/i.pinch.startD,y.pageX=i.pinch.endX,y.pageY=i.pinch.endY,y.scale=i.scaleD,y.deltaX=i.pinch.endX-i.pinch.startX,y.deltaY=i.pinch.endY-i.pinch.startY}else i.pan||(m=!1);m&&i.$el.trigger(y)}}function r(t,i){t.on(v.click,i,l);var n=e._data(t[0],"events").click;n.unshift(n.pop())}function l(e){b.killEvent(e,!0),e.data.$links.off(v.click)}function c(t){var i=t.data;if(i.tap)i.$el.off([v.touchMove,v.touchEnd,v.touchCancel,v.pointerMove,v.pointerUp,v.pointerCancel,v.mouseMove,v.mouseUp].join(" ")),i.startE.preventDefault(),d(t);else if(i.pan||i.scale){var n="undefined"!==e.type(i.touches)?i.touches[0]:null,a=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=a-i.startX,l=o-i.startY,c=(new Date).getTime(),p=i.scale?v.scaleEnd:v.panEnd,f=s>0?"right":"left",h=l>0?"down":"up",g=Math.abs(s)>1,m=Math.abs(l)>1;if(i.swipe&&Math.abs(s)>w&&c-i.startT<$&&(p=v.swipe),i.axis&&(i.axisX&&m||i.axisY&&g)||g||m){i.$links=i.$el.find("a");for(var b=0,x=i.$links.length;x>b;b++)r(i.$links.eq(b),i)}var C=u(p,t,a,o,i.scaleD,s,l,f,h);y.off([v.touchMove,v.touchEnd,v.touchCancel,v.mouseMove,v.mouseUp,v.pointerMove,v.pointerUp,v.pointerCancel].join(" ")),i.$el.trigger(C),i.touches=[],i.scale}i.touching=!1}function d(e){b.killEvent(e);var t=e.data,i=e.type;if("click"===i||!t.clicked){"click"!==i&&(t.clicked=!0);var n=t.startE?t.startX:e.pageX,a=t.startE?t.startY:e.pageY,o=u(v.tap,e.originalEvent,n,a,1,0,0);t.$el.trigger(o)}}function u(t,i,n,a,o,s,r,l,c){return e.Event(t,{originalEvent:i,bubbles:!0,pageX:n,pageY:a,scale:o,deltaX:s,deltaY:r,directionX:l,directionY:c})}function p(e,t){return(e+t)/2}function f(e,t){return Math.sqrt(e*e+t*t)}function h(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var g=!t.window.PointerEvent,m=t.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:i,_destruct:n},events:{pointerDown:g?"MSPointerDown":"pointerdown",pointerUp:g?"MSPointerUp":"pointerup",pointerMove:g?"MSPointerMove":"pointermove",pointerCancel:g?"MSPointerCancel":"pointercancel"}}),v=m.events,b=m.functions,y=t.$window,w=10,$=50;v.tap="tap",v.pan="pan",v.panStart="panstart",v.panEnd="panend",v.scale="scale",v.scaleStart="scalestart",v.scaleEnd="scaleend",v.swipe="swipe"}(jQuery,Formstone);
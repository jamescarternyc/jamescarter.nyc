!function(e,t,i){"use strict";function n(e){e.touches=[],e.touching=!1,this.on(b.dragStart,y.killEvent),e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on(b.touchStart,e,s).on(b.click,e,u),t.support.touch&&t.support.pointer&&this.on(b.pointerDown,e,s)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):g(this,"none"),this.on(b.touchStart,e,o).on(b.mouseDown,e,s),t.support.touch&&t.support.pointer&&this.on(b.pointerDown,e,o))}function a(e){this.off(b.namespace),g(this,"")}function o(e){e.preventManipulation&&e.preventManipulation();var t=e.data,i=e.originalEvent;if(i.type.match(/(up|end|cancel)$/i))return void d(e);if(i.pointerId){var n=!1;for(var a in t.touches)t.touches[a].id===i.pointerId&&(n=!0,t.touches[a].pageX=i.clientX,t.touches[a].pageY=i.clientY);n||t.touches.push({id:i.pointerId,pageX:i.clientX,pageY:i.clientY})}else t.touches=i.touches;i.type.match(/(down|start)$/i)?s(e):i.type.match(/move$/i)&&r(e)}function s(t){var i=t.data,n="undefined"!==e.type(i.touches)?i.touches[0]:null;if(i.touching||(i.startE=t.originalEvent,i.startX=n?n.pageX:t.pageX,i.startY=n?n.pageY:t.pageY,i.startT=(new Date).getTime(),i.scaleD=1,i.passed=!1),i.tap)i.clicked=!1,i.$el.on([b.touchMove,b.pointerMove].join(" "),i,o).on([b.touchEnd,b.touchCancel,b.pointerUp,b.pointerCancel].join(" "),i,o);else if(i.pan||i.scale){i.$links&&i.$links.off(b.click);var a=p(i.scale?b.scaleStart:b.panStart,t,i.startX,i.startY,i.scaleD,0,0,"","");if(i.scale&&i.touches&&i.touches.length>=2){var s=i.touches;i.pinch={startX:f(s[0].pageX,s[1].pageX),startY:f(s[0].pageY,s[1].pageY),startD:h(s[1].pageX-s[0].pageX,s[1].pageY-s[0].pageY)},a.pageX=i.startX=i.pinch.startX,a.pageY=i.startY=i.pinch.startY}i.touching||(i.touching=!0,i.pan&&w.on(b.mouseMove,i,r).on(b.mouseUp,i,d),w.on([b.touchMove,b.touchEnd,b.touchCancel,b.pointerMove,b.pointerUp,b.pointerCancel].join(" "),i,o),i.$el.trigger(a))}}function r(t){var i=t.data,n="undefined"!==e.type(i.touches)?i.touches[0]:null,a=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=a-i.startX,r=o-i.startY,l=s>0?"right":"left",c=r>0?"down":"up",u=Math.abs(s)>$,g=Math.abs(r)>$;if(i.tap)(u||g)&&i.$el.off([b.touchMove,b.touchEnd,b.touchCancel,b.pointerMove,b.pointerUp,b.pointerCancel].join(" "));else if(i.pan||i.scale)if(!i.passed&&i.axis&&(i.axisX&&g||i.axisY&&u))d(t);else{!i.passed&&(!i.axis||i.axis&&i.axisX&&u||i.axisY&&g)&&(i.passed=!0),i.passed&&(y.killEvent(t),y.killEvent(i.startE));var m=!0,v=p(i.scale?b.scale:b.pan,t,a,o,i.scaleD,s,r,l,c);if(i.scale)if(i.touches&&i.touches.length>=2){var w=i.touches;i.pinch.endX=f(w[0].pageX,w[1].pageX),i.pinch.endY=f(w[0].pageY,w[1].pageY),i.pinch.endD=h(w[1].pageX-w[0].pageX,w[1].pageY-w[0].pageY),i.scaleD=i.pinch.endD/i.pinch.startD,v.pageX=i.pinch.endX,v.pageY=i.pinch.endY,v.scale=i.scaleD,v.deltaX=i.pinch.endX-i.pinch.startX,v.deltaY=i.pinch.endY-i.pinch.startY}else i.pan||(m=!1);m&&i.$el.trigger(v)}}function l(t,i){t.on(b.click,i,c);var n=e._data(t[0],"events").click;n.unshift(n.pop())}function c(e){y.killEvent(e,!0),e.data.$links.off(b.click)}function d(t){var i=t.data;if(i.tap)i.$el.off([b.touchMove,b.touchEnd,b.touchCancel,b.pointerMove,b.pointerUp,b.pointerCancel,b.mouseMove,b.mouseUp].join(" ")),i.startE.preventDefault(),u(t);else if(i.pan||i.scale){var n="undefined"!==e.type(i.touches)?i.touches[0]:null,a=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=a-i.startX,r=o-i.startY,c=(new Date).getTime(),d=i.scale?b.scaleEnd:b.panEnd,f=s>0?"right":"left",h=r>0?"down":"up",g=Math.abs(s)>1,m=Math.abs(r)>1;if(i.swipe&&Math.abs(s)>$&&c-i.startT<x&&(d=b.swipe),i.axis&&(i.axisX&&m||i.axisY&&g)||g||m){i.$links=i.$el.find("a");for(var v=0,y=i.$links.length;y>v;v++)l(i.$links.eq(v),i)}var C=p(d,t,a,o,i.scaleD,s,r,f,h);w.off([b.touchMove,b.touchEnd,b.touchCancel,b.mouseMove,b.mouseUp,b.pointerMove,b.pointerUp,b.pointerCancel].join(" ")),i.$el.trigger(C),i.touches=[],i.scale}i.touching=!1}function u(e){y.killEvent(e);var t=e.data,i=e.type;if("click"===i||!t.clicked){"click"!==i&&(t.clicked=!0);var n=t.startE?t.startX:e.pageX,a=t.startE?t.startY:e.pageY,o=p(b.tap,e.originalEvent,n,a,1,0,0);t.$el.trigger(o)}}function p(t,i,n,a,o,s,r,l,c){return e.Event(t,{originalEvent:i,bubbles:!0,pageX:n,pageY:a,scale:o,deltaX:s,deltaY:r,directionX:l,directionY:c})}function f(e,t){return(e+t)/2}function h(e,t){return Math.sqrt(e*e+t*t)}function g(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var m=!t.window.PointerEvent,v=t.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:n,_destruct:a},events:{pointerDown:m?"MSPointerDown":"pointerdown",pointerUp:m?"MSPointerUp":"pointerup",pointerMove:m?"MSPointerMove":"pointermove",pointerCancel:m?"MSPointerCancel":"pointercancel"}}),b=v.events,y=v.functions,w=t.$window,$=10,x=50;b.tap="tap",b.pan="pan",b.panStart="panstart",b.panEnd="panend",b.scale="scale",b.scaleStart="scalestart",b.scaleEnd="scaleend",b.swipe="swipe"}(jQuery,Formstone);
!function(e,t){"use strict";function i(){m=t.$body}function n(){$.iterate.call(x,l)}function a(){x=e(b.base)}function o(e){var t="";t+='<div class="'+y.bar+'">',t+='<div class="'+y.track+'">',t+='<span class="'+y.handle+'"></span>',t+="</div></div>",e.paddingRight=parseInt(this.css("padding-right"),10),e.paddingBottom=parseInt(this.css("padding-bottom"),10),this.addClass([y.base,e.customClass,e.horizontal?y.horizontal:""].join(" ")).wrapInner('<div class="'+y.content+'" />').prepend(t),e.$content=this.find(b.content),e.$bar=this.find(b.bar),e.$track=this.find(b.track),e.$handle=this.find(b.handle),e.trackMargin=parseInt(e.trackMargin,10),e.$content.on(w.scroll,e,c),e.mouseWheel&&e.$content.on("DOMMouseScroll"+w.namespace+" mousewheel"+w.namespace,e,d),e.$track.fsTouch({axis:e.horizontal?"x":"y",pan:!0}).on(w.panStart,e,p).on(w.pan,e,f).on(w.panEnd,e,h),l(e),a()}function s(e){e.$track.fsTouch("destroy"),e.$bar.remove(),e.$content.off(w.namespace).contents().unwrap(),this.removeClass([y.base,y.active,e.customClass].join(" ")).off(w.namespace)}function r(t,i,n){var a=n||t.duration,o={};if("number"!==e.type(i)){var s=e(i);if(s.length>0){var r=s.position();i=t.horizontal?r.left+t.$content.scrollLeft():r.top+t.$content.scrollTop()}else i="top"===i?0:"bottom"===i?t.horizontal?t.$content[0].scrollWidth:t.$content[0].scrollHeight:t.$content.scrollTop()}o[t.horizontal?"scrollLeft":"scrollTop"]=i,t.$content.stop().animate(o,a)}function l(e){e.$el.addClass(y.isSetup);var t={},i={},n={},a=0,o=!0;if(e.horizontal){e.barHeight=e.$content[0].offsetHeight-e.$content[0].clientHeight,e.frameWidth=e.$content.outerWidth(),e.trackWidth=e.frameWidth-2*e.trackMargin,e.scrollWidth=e.$content[0].scrollWidth,e.ratio=e.trackWidth/e.scrollWidth,e.trackRatio=e.trackWidth/e.scrollWidth,e.handleWidth=e.handleSize>0?e.handleSize:e.trackWidth*e.trackRatio,e.scrollRatio=(e.scrollWidth-e.frameWidth)/(e.trackWidth-e.handleWidth),e.handleBounds={left:0,right:e.trackWidth-e.handleWidth},e.$content.css({paddingBottom:e.barHeight+e.paddingBottom});var s=e.$content.scrollLeft();a=s*e.ratio,o=e.scrollWidth<=e.frameWidth,t={width:e.frameWidth},i={width:e.trackWidth,marginLeft:e.trackMargin,marginRight:e.trackMargin},n={width:e.handleWidth}}else{e.barWidth=e.$content[0].offsetWidth-e.$content[0].clientWidth,e.frameHeight=e.$content.outerHeight(),e.trackHeight=e.frameHeight-2*e.trackMargin,e.scrollHeight=e.$content[0].scrollHeight,e.ratio=e.trackHeight/e.scrollHeight,e.trackRatio=e.trackHeight/e.scrollHeight,e.handleHeight=e.handleSize>0?e.handleSize:e.trackHeight*e.trackRatio,e.scrollRatio=(e.scrollHeight-e.frameHeight)/(e.trackHeight-e.handleHeight),e.handleBounds={top:0,bottom:e.trackHeight-e.handleHeight};var r=e.$content.scrollTop();a=r*e.ratio,o=e.scrollHeight<=e.frameHeight,t={height:e.frameHeight},i={height:e.trackHeight,marginBottom:e.trackMargin,marginTop:e.trackMargin},n={height:e.handleHeight}}o?e.$el.removeClass(y.active):e.$el.addClass(y.active),e.$bar.css(t),e.$track.css(i),e.$handle.css(n),e.panning=!1,g(e,a),c({data:e}),e.$el.removeClass(y.setup)}function c(e){$.killEvent(e);var t=e.data,i={};if(!t.panning){if(t.horizontal){var n=t.$content.scrollLeft();0>n&&(n=0),t.handleLeft=n/t.scrollRatio,t.handleLeft>t.handleBounds.right&&(t.handleLeft=t.handleBounds.right),i={left:t.handleLeft}}else{var a=t.$content.scrollTop();0>a&&(a=0),t.handleTop=a/t.scrollRatio,t.handleTop>t.handleBounds.bottom&&(t.handleTop=t.handleBounds.bottom),i={top:t.handleTop}}t.$handle.css(i)}}function d(e){var t,i,n=e.data;if(n.horizontal){var a=n.$content[0].scrollLeft,o=n.$content[0].scrollWidth,s=n.$content.outerWidth();if(t="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,i=t>0?"right":"left","left"===i&&-t>o-s-a)return n.$content.scrollLeft(o),u(e);if("right"===i&&t>a)return n.$content.scrollLeft(0),u(e)}else{var r=n.$content[0].scrollTop,l=n.$content[0].scrollHeight,c=n.$content.outerHeight();if(t="DOMMouseScroll"===e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,i=t>0?"up":"down","down"===i&&-t>l-c-r)return n.$content.scrollTop(l),u(e);if("up"===i&&t>r)return n.$content.scrollTop(0),u(e)}}function u(e){return $.killEvent(e),e.returnValue=!1,!1}function p(e){var t,i=e.data,n=i.$track.offset();i.panning=!0,t=i.horizontal?i.handleLeft=e.pageX-n.left-i.handleWidth/2:i.handleTop=e.pageY-n.top-i.handleHeight/2,g(i,t)}function f(e){var t,i=e.data;t=i.horizontal?i.handleLeft+e.deltaX:i.handleTop+e.deltaY,g(i,t)}function h(e){var t=e.data;t.panning=!1,t.horizontal?t.handleLeft+=e.deltaX:t.handleTop+=e.deltaY}function g(e,t){var i={};e.horizontal?(t<e.handleBounds.left&&(t=e.handleBounds.left),t>e.handleBounds.right&&(t=e.handleBounds.right),i={left:t},e.$content.scrollLeft(Math.round(t*e.scrollRatio))):(t<e.handleBounds.top&&(t=e.handleBounds.top),t>e.handleBounds.bottom&&(t=e.handleBounds.bottom),i={top:t},e.$content.scrollTop(Math.round(t*e.scrollRatio))),e.$handle.css(i)}var m,v=t.Plugin("scrollbar",{widget:!0,defaults:{customClass:"",duration:0,handleSize:0,horizontal:!1,mouseWheel:!0,trackMargin:0},classes:["content","bar","track","handle","horizontal","setup","active"],methods:{_setup:i,_construct:o,_destruct:s,_resize:n,scroll:r,resize:l}}),b=v.classes,y=b.raw,w=v.events,$=v.functions,x=(t.$window,[])}(jQuery,Formstone);